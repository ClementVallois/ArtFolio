events {}
http {
    server {

        listen 80 default_server;


        server_name _;


        return 301 https://$host$request_uri;

    }
    server {
        server_name artfolio.dev;
        listen 443 ssl;
        ssl_certificate /opt/certs/live/artfolio.dev/fullchain.pem;
        ssl_certificate_key /opt/certs/live/artfolio.dev/privkey.pem;
        ssl_buffer_size 8k;
        ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
        ssl_prefer_server_ciphers on;
        client_max_body_size 10g;
        ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;

        location / {
            root /usr/share/nginx/html/frontend;
            index index.html;
            try_files $uri $uri/ /index.html;
        }

        # location / {
        # proxy_pass http://frontend-main:5174;
        # rewrite ^/frontend-main(.*)$ $1 break;
        # }

    }
    server {
        server_name admin.artfolio.dev;
        listen 443 ssl;
        ssl_certificate /opt/certs/live/admin.artfolio.dev/fullchain.pem;
        ssl_certificate_key /opt/certs/live/admin.artfolio.com/privkey.pem;
        ssl_buffer_size 8k;
        ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
        ssl_prefer_server_ciphers on;
        ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;


        location / {
            root /user/share/nginx/html/admin-dashboard;
            index index.html;
            try_files $uri $uri/ /index.html;
        }

        # location / {
        # proxy_pass http://admin-dashboard:8081;
        # rewrite ^/admin.msmaviation(.*)$ $1 break;
        # }

        # Proxy requests to the backend API
        location /backend/ {
        proxy_pass http://backend-api:3000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        }
    }
}